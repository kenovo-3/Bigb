<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Rescue - Three.js Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            overflow: hidden;
            background: linear-gradient(to bottom, #0a0a2a, #1a1a3a);
            color: white;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #canvas {
            display: block;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            pointer-events: none;
        }
        
        #score {
            font-size: 24px;
            margin-bottom: 10px;
            text-align: center;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }
        
        #health-bar {
            width: 300px;
            height: 20px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            margin: 0 auto;
            overflow: hidden;
        }
        
        #health {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #ff3300, #ffcc00);
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        #level {
            text-align: center;
            margin-top: 10px;
            font-size: 20px;
            color: #00ccff;
        }
        
        #start-screen, #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10;
        }
        
        #game-over {
            display: none;
        }
        
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ffcc00;
            text-shadow: 0 0 20px rgba(255, 204, 0, 0.7);
        }
        
        h2 {
            font-size: 32px;
            margin-bottom: 30px;
            color: #00ccff;
        }
        
        .btn {
            padding: 15px 40px;
            font-size: 20px;
            background: linear-gradient(to bottom, #ff6600, #ff3300);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(255, 51, 0, 0.6);
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 51, 0, 0.8);
        }
        
        .difficulty {
            display: flex;
            margin: 20px 0;
        }
        
        #instructions {
            max-width: 600px;
            text-align: center;
            margin: 20px 0;
            line-height: 1.6;
            color: #cccccc;
        }
        
        #boss-warning {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 36px;
            color: #ff0066;
            text-shadow: 0 0 20px rgba(255, 0, 102, 0.7);
            transform: translateY(-50%);
            display: none;
        }
        
        .power-up {
            position: absolute;
            font-size: 18px;
            color: #00ff99;
            text-shadow: 0 0 10px rgba(0, 255, 153, 0.7);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="canvas"></canvas>
        
        <div id="ui">
            <div id="score">Score: 0</div>
            <div id="health-bar"><div id="health"></div></div>
            <div id="level">Level: 1</div>
        </div>
        
        <div id="boss-warning">WARNING! BOSS APPROACHING</div>
        
        <div id="start-screen">
            <h1>SPACE RESCUE</h1>
            <h2>Mission to Save the Galaxy</h2>
            <div id="instructions">
                <p>Your mission is to rescue astronauts stranded in space while battling enemy ships and avoiding asteroids.</p>
                <p>Use WASD or Arrow Keys to move, Mouse to aim and shoot. Collect power-ups to enhance your ship!</p>
            </div>
            <div class="difficulty">
                <button class="btn" onclick="startGame('easy')">Easy</button>
                <button class="btn" onclick="startGame('normal')">Normal</button>
                <button class="btn" onclick="startGame('hard')">Hard</button>
            </div>
        </div>
        
        <div id="game-over">
            <h1>MISSION FAILED</h1>
            <h2 id="final-score">Score: 0</h2>
            <button class="btn" onclick="restartGame()">Try Again</button>
        </div>
    </div>

    <script>
        // Game variables
        let scene, camera, renderer, controls;
        let player, enemies = [], bullets = [], asteroids = [], powerUps = [], rescuedAstronauts = 0;
        let score = 0, health = 100, level = 1, difficulty = 'normal';
        let gameStarted = false;
        let boss = null;
        let bossActive = false;
        let clock = new THREE.Clock();
        
        // Initialize the game
        function init() {
            // Create scene
            scene = new THREE.Scene();
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 15;
            camera.position.y = 5;
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000011);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 5, 5);
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x00ff00, 1, 100);
            pointLight.position.set(0, 0, 0);
            scene.add(pointLight);
            
            // Create stars background
            createStarField();
            
            // Create player ship
            createPlayer();
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize);
            
            // Start animation loop
            animate();
        }
        
        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true
            });
            
            const starVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const starField = new THREE.Points(starGeometry, starMaterial);
            scene.add(starField);
        }
        
        function createPlayer() {
            const geometry = new THREE.ConeGeometry(1, 3, 4);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x00ccff,
                shininess: 100,
                specular: 0xffffff
            });
            
            player = new THREE.Mesh(geometry, material);
            player.rotation.x = Math.PI;
            player.position.y = -8;
            scene.add(player);
            
            // Add engine glow
            const glowGeometry = new THREE.ConeGeometry(0.5, 1, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xff9900,
                transparent: true,
                opacity: 0.7
            });
            
            const engineGlow = new THREE.Mesh(glowGeometry, glowMaterial);
            engineGlow.position.z = -1.5;
            engineGlow.rotation.x = Math.PI;
            player.add(engineGlow);
        }
        
        function createEnemy(type, x, y) {
            const geometry = new THREE.ConeGeometry(1, 2, 4);
            const material = new THREE.MeshPhongMaterial({ 
                color: type === 'boss' ? 0xff0066 : 0xff0000,
                shininess: 100
            });
            
            const enemy = new THREE.Mesh(geometry, material);
            enemy.position.set(x, y, 0);
            enemy.rotation.x = Math.PI / 2;
            
            enemy.type = type;
            enemy.health = type === 'boss' ? 500 : 100;
            enemy.speed = type === 'boss' ? 0.5 : (Math.random() * 2 + 1);
            enemy.value = type === 'boss' ? 1000 : 100;
            
            scene.add(enemy);
            enemies.push(enemy);
            
            return enemy;
        }
        
        function createAsteroid() {
            const size = Math.random() * 2 + 1;
            const geometry = new THREE.SphereGeometry(size, 10, 10);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x888888,
                shininess: 30
            });
            
            const asteroid = new THREE.Mesh(geometry, material);
            
            // Set random position at the top of the screen
            asteroid.position.x = (Math.random() - 0.5) * 20;
            asteroid.position.y = 15;
            asteroid.position.z = (Math.random() - 0.5) * 10;
            
            // Set random rotation velocity
            asteroid.rotationSpeed = {
                x: Math.random() * 0.1 - 0.05,
                y: Math.random() * 0.1 - 0.05,
                z: Math.random() * 0.1 - 0.05
            };
            
            asteroid.speed = Math.random() * 2 + 1;
            scene.add(asteroid);
            asteroids.push(asteroid);
            
            return asteroid;
        }
        
        function createPowerUp(x, y) {
            const geometry = new THREE.SphereGeometry(0.5, 16, 16);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x00ff99,
                emissive: 0x00ff99,
                emissiveIntensity: 0.5,
                transparent: true,
                opacity: 0.8
            });
            
            const powerUp = new THREE.Mesh(geometry, material);
            powerUp.position.set(x, y, 0);
            powerUp.type = Math.random() > 0.5 ? 'health' : 'weapon';
            
            scene.add(powerUp);
            powerUps.push(powerUp);
            
            return powerUp;
        }
        
        function shoot() {
            const geometry = new THREE.SphereGeometry(0.2, 10, 10);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ffff });
            
            const bullet = new THREE.Mesh(geometry, material);
            bullet.position.copy(player.position);
            bullet.speed = 10;
            
            scene.add(bullet);
            bullets.push(bullet);
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            
            if (gameStarted) {
                updatePlayer(delta);
                updateEnemies(delta);
                updateBullets(delta);
                updateAsteroids(delta);
                updatePowerUps(delta);
                updateBoss(delta);
                checkCollisions();
                
                // Occasionally spawn enemies and asteroids
                if (Math.random() < 0.03) createEnemy('normal', (Math.random() - 0.5) * 20, 10);
                if (Math.random() < 0.02) createAsteroid();
                
                // Chance to spawn power-up when enemy is destroyed (handled in checkCollisions)
                
                // Level progression
                if (score >= level * 1000 && !bossActive) {
                    levelUp();
                }
            }
            
            renderer.render(scene, camera);
        }
        
        function updatePlayer(delta) {
            // Simple player movement based on mouse position
            const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            const targetX = mouseX * 10;
            
            player.position.x += (targetX - player.position.x) * 0.1;
            
            // Keep player within bounds
            player.position.x = Math.max(-10, Math.min(10, player.position.x));
        }
        
        function updateEnemies(delta) {
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                enemy.position.y -= enemy.speed * delta;
                
                // Remove enemies that are off screen
                if (enemy.position.y < -12) {
                    scene.remove(enemy);
                    enemies.splice(i, 1);
                }
            }
        }
        
        function updateBullets(delta) {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.position.y += bullet.speed;
                
                // Remove bullets that are off screen
                if (bullet.position.y > 12) {
                    scene.remove(bullet);
                    bullets.splice(i, 1);
                }
            }
        }
        
        function updateAsteroids(delta) {
            for (let i = asteroids.length - 1; i >= 0; i--) {
                const asteroid = asteroids[i];
                asteroid.position.y -= asteroid.speed * delta;
                
                // Rotate asteroid
                asteroid.rotation.x += asteroid.rotationSpeed.x;
                asteroid.rotation.y += asteroid.rotationSpeed.y;
                asteroid.rotation.z += asteroid.rotationSpeed.z;
                
                // Remove asteroids that are off screen
                if (asteroid.position.y < -12) {
                    scene.remove(asteroid);
                    asteroids.splice(i, 1);
                }
            }
        }
        
        function updatePowerUps(delta) {
            for (let i = powerUps.length - 1; i >= 0; i--) {
                const powerUp = powerUps[i];
                powerUp.position.y -= 2 * delta;
                powerUp.rotation.x += 0.1;
                powerUp.rotation.y += 0.1;
                
                // Remove power-ups that are off screen
                if (powerUp.position.y < -12) {
                    scene.remove(powerUp);
                    powerUps.splice(i, 1);
                }
            }
        }
        
        function updateBoss(delta) {
            if (boss) {
                // Boss movement pattern
                boss.position.x = Math.sin(Date.now() * 0.001) * 8;
                
                // Boss shooting
                if (Math.random() < 0.05) {
                    bossShoot();
                }
            }
        }
        
        function bossShoot() {
            const geometry = new THREE.SphereGeometry(0.3, 10, 10);
            const material = new THREE.MeshBasicMaterial({ color: 0xff0066 });
            
            for (let i = -1; i <= 1; i++) {
                const bullet = new THREE.Mesh(geometry, material);
                bullet.position.copy(boss.position);
                bullet.speed = 5;
                bullet.direction = new THREE.Vector3(i * 0.3, -1, 0).normalize();
                
                scene.add(bullet);
                bullets.push(bullet);
            }
        }
        
        function checkCollisions() {
            // Bullet vs Enemy
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const bullet = bullets[i];
                    const enemy = enemies[j];
                    
                    const distance = bullet.position.distanceTo(enemy.position);
                    
                    if (distance < (enemy.type === 'boss' ? 3 : 1.5)) {
                        // Hit detected
                        scene.remove(bullet);
                        bullets.splice(i, 1);
                        
                        enemy.health -= 50;
                        
                        if (enemy.health <= 0) {
                            // Enemy destroyed
                            score += enemy.value;
                            document.getElementById('score').textContent = `Score: ${score}`;
                            
                            // Chance to spawn power-up
                            if (Math.random() < 0.3) {
                                createPowerUp(enemy.position.x, enemy.position.y);
                            }
                            
                            scene.remove(enemy);
                            enemies.splice(j, 1);
                            
                            // If it was a boss, end boss fight
                            if (enemy.type === 'boss') {
                                boss = null;
                                bossActive = false;
                                showPowerUpMessage("BOSS DEFEATED! +1000", 1000);
                            }
                        }
                        
                        break;
                    }
                }
            }
            
            // Player vs Enemy
            for (let i = enemies.length - 1; i >= 0; i--) {
                const enemy = enemies[i];
                const distance = player.position.distanceTo(enemy.position);
                
                if (distance < 2) {
                    // Collision with enemy
                    takeDamage(20);
                    
                    scene.remove(enemy);
                    enemies.splice(i, 1);
                }
            }
            
            // Player vs Asteroid
            for (let i = asteroids.length - 1; i >= 0; i--) {
                const asteroid = asteroids[i];
                const distance = player.position.distanceTo(asteroid.position);
                
                if (distance < asteroid.geometry.parameters.radius + 1.5) {
                    // Collision with asteroid
                    takeDamage(10);
                    
                    scene.remove(asteroid);
                    asteroids.splice(i, 1);
                }
            }
            
            // Player vs Power-up
            for (let i = powerUps.length - 1; i >= 0; i--) {
                const powerUp = powerUps[i];
                const distance = player.position.distanceTo(powerUp.position);
                
                if (distance < 1.5) {
                    // Power-up collected
                    if (powerUp.type === 'health') {
                        health = Math.min(100, health + 20);
                        updateHealthBar();
                        showPowerUpMessage("HEALTH RESTORED!", powerUp.position.x, powerUp.position.y);
                    } else {
                        // Weapon upgrade - temporarily increase fire rate
                        showPowerUpMessage("WEAPON UPGRADE!", powerUp.position.x, powerUp.position.y);
                    }
                    
                    scene.remove(powerUp);
                    powerUps.splice(i, 1);
                }
            }
            
            // Boss bullets vs Player
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                if (bullet.direction) { // Boss bullets have direction property
                    const distance = player.position.distanceTo(bullet.position);
                    
                    if (distance < 1.5) {
                        // Hit by boss bullet
                        takeDamage(5);
                        
                        scene.remove(bullet);
                        bullets.splice(i, 1);
                    }
                }
            }
        }
        
        function takeDamage(amount) {
            health -= amount;
            updateHealthBar();
            
            if (health <= 0) {
                endGame();
            }
        }
        
        function updateHealthBar() {
            document.getElementById('health').style.width = `${health}%`;
        }
        
        function levelUp() {
            level++;
            document.getElementById('level').textContent = `Level: ${level}`;
            
            // Every 3 levels, spawn a boss
            if (level % 3 === 0) {
                spawnBoss();
            }
        }
        
        function spawnBoss() {
            bossActive = true;
            document.getElementById('boss-warning').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('boss-warning').style.display = 'none';
                boss = createEnemy('boss', 0, 10);
            }, 3000);
        }
        
        function showPowerUpMessage(message, x, y) {
            const element = document.createElement('div');
            element.className = 'power-up';
            element.textContent = message;
            element.style.left = `${x + 10}px`;
            element.style.top = `${y + 10}px`;
            
            document.getElementById('game-container').appendChild(element);
            
            // Animate the message
            let opacity = 1;
            let yPos = y;
            
            const animateMessage = setInterval(() => {
                opacity -= 0.02;
                yPos -= 1;
                
                element.style.opacity = opacity;
                element.style.top = `${yPos}px`;
                
                if (opacity <= 0) {
                    clearInterval(animateMessage);
                    element.remove();
                }
            }, 30);
        }
        
        function startGame(selectedDifficulty) {
            difficulty = selectedDifficulty;
            document.getElementById('start-screen').style.display = 'none';
            gameStarted = true;
            
            // Set initial values based on difficulty
            if (difficulty === 'easy') {
                health = 120;
            } else if (difficulty === 'normal') {
                health = 100;
            } else {
                health = 80;
            }
            
            updateHealthBar();
            
            // Start shooting automatically
            setInterval(shoot, 300);
        }
        
        function endGame() {
            gameStarted = false;
            document.getElementById('final-score').textContent = `Score: ${score}`;
            document.getElementById('game-over').style.display = 'flex';
        }
        
        function restartGame() {
            // Reset game state
            score = 0;
            level = 1;
            rescuedAstronauts = 0;
            
            document.getElementById('score').textContent = `Score: ${score}`;
            document.getElementById('level').textContent = `Level: ${level}`;
            document.getElementById('game-over').style.display = 'none';
            
            // Remove all enemies, asteroids, and power-ups
            for (let i = enemies.length - 1; i >= 0; i--) {
                scene.remove(enemies[i]);
                enemies.splice(i, 1);
            }
            
            for (let i = asteroids.length - 1; i >= 0; i--) {
                scene.remove(asteroids[i]);
                asteroids.splice(i, 1);
            }
            
            for (let i = powerUps.length - 1; i >= 0; i--) {
                scene.remove(powerUps[i]);
                powerUps.splice(i, 1);
            }
            
            for (let i = bullets.length - 1; i >= 0; i--) {
                scene.remove(bullets[i]);
                bullets.splice(i, 1);
            }
            
            if (boss) {
                scene.remove(boss);
                boss = null;
                bossActive = false;
            }
            
            // Show start screen
            document.getElementById('start-screen').style.display = 'flex';
        }
        
        // Initialize the game when the window loads
        window.addEventListener('load', init);
        
        // Handle mouse movement for player control
        document.addEventListener('mousemove', (event) => {
            if (!gameStarted) return;
        });
    </script>
</body>
</html>
